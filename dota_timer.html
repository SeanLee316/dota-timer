<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Dota 2 –¢–∞–π–º–µ—Ä v7 (LockScreen)</title>
    <style>
        /* --- –û–ë–©–ò–ï –°–¢–ò–õ–ò --- */
        :root {
            --bg-color: #1c1c1e;
            --panel-bg-color: #2a2a2a;
            --text-color: #e0e0e0;
            --accent-color: #00aeff;
            --accent-hover-color: #007acc;
            --warning-color: #ffc107;
            --event-now-color: #dc3545;
            --positive-color: #5cb85c;
            --positive-hover-color: #4cae4c;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –±—É–¥–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å –µ–π */
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px; /* –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }
        .app-wrapper { /* –ù–æ–≤–∞—è –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
            display: flex;
            flex-direction: column; /* –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto; /* –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        }
        .main-container {
            display: flex;
            flex-direction: row;
            width: 100%;
            max-width: 1300px;
            gap: 15px;
            flex-grow: 1; /* –ß—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞–ª –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ –≤ .app-wrapper */
            min-height: 0; /* –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã flex-grow –∏ overflow –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö */
        }
        .left-panel, .right-panel {
            display: flex;
            flex-direction: column;
            min-width: 0; /* –î–ª—è —Å–∂–∞—Ç–∏—è */
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º –∏–∑–±—ã—Ç–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        .left-panel { flex: 2.5; align-items: center; }
        .right-panel {
            flex: 1.5;
            background-color: var(--panel-bg-color);
            padding: 10px 12px;
            border-radius: 8px;
            overflow-y: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ª–æ–≥–∞ */
        }
        #timerDisplay {
            font-size: 3.2em; margin-bottom: 8px; color: var(--accent-color);
            font-weight: bold; text-shadow: 0 0 5px rgba(0,174,255,0.5);
            text-align: center;
        }
        .controls-column {
            display: flex; flex-direction: column; align-items: center;
            gap: 8px; margin-bottom: 12px; width: 100%;
        }
        .control-group { /* –ù–æ–≤–∞—è –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è –≥—Ä—É–ø–ø –∫–Ω–æ–ø–æ–∫ */
            display: flex; align-items: center; gap: 8px;
            background-color: var(--panel-bg-color);
            padding: 8px; border-radius: 5px;
            flex-wrap: wrap; justify-content: center;
            width: calc(100% - 16px); box-sizing: border-box;
        }
        .control-group input[type="number"] {
            width: 45px; padding: 7px; font-size: 0.95em; text-align: center;
            border: 1px solid #444; background-color: #333; color: var(--text-color);
            border-radius: 3px; -moz-appearance: textfield;
        }
        .control-group input[type="number"]::-webkit-outer-spin-button,
        .control-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        .control-group span { font-size: 1.1em; color: var(--accent-color); }
        .control-group button {
            font-size: 0.95em; padding: 7px 12px; cursor: pointer;
            border: none; border-radius: 5px; color: #ffffff;
            transition: background-color 0.2s ease-in-out;
        }
        .main-controls button, #lockScreenToggle { background-color: var(--accent-color); }
        .main-controls button:hover, #lockScreenToggle:hover { background-color: var(--accent-hover-color); }
        .time-sync-controls button { background-color: var(--positive-color); }
        .time-sync-controls button:hover { background-color: var(--positive-hover-color); }
        .notification-controls button { background-color: var(--warning-color); color: #1e1e1e; }
        .notification-controls button:hover { background-color: #e0a800; }

        .section-title {
            text-align: center; color: var(--accent-color);
            font-size: 1.4em; margin-bottom: 8px;
        }
        #upcomingEvents { width:100%; max-width: 600px; overflow-y: auto; flex-shrink: 1; }
        #upcomingEvents ul, #pastEventsLog ul, #dynamicRecentEventsList ul {
            list-style: none; padding: 0; margin:0;
        }
        #upcomingEvents li, #pastEventsLog li, #dynamicRecentEventsList li {
            background-color: #333333; padding: 8px 10px; margin-bottom: 6px;
            border-radius: 4px; font-size: 1em;
            border-left: 3px solid var(--accent-color);
        }
        #pastEventsLog li { border-left-color: var(--positive-color); font-size: 0.9em; }
        #upcomingEvents li .event-details {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 4px;
        }
        .event-name { font-weight: bold; }
        .event-time, .log-time { color: #b0b0b0; font-size:0.95em; }
        .progress-bar-container {
            height: 10px; /* –ó–∞–º–µ—Ç–Ω–µ–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
            background-color: #555; border-radius: 5px;
            overflow: hidden; margin-top: 5px;
        }
        .progress-bar {
            height: 100%; background-color: var(--accent-color); width: 0%;
            transition: width 0.5s linear;
        }
        .alert-warning { border-left-color: var(--warning-color) !important; }
        .alert-event-now {
            border-left-color: var(--event-now-color) !important;
            animation: pulse 0.8s infinite alternate;
        }
        @keyframes pulse {
            0% { background-color: rgba(220, 53, 69, 0.4); }
            100% { background-color: rgba(220, 53, 69, 0.15); }
        }
        .right-panel::-webkit-scrollbar { width: 6px; }
        .right-panel::-webkit-scrollbar-track { background: var(--panel-bg-color); border-radius: 6px; }
        .right-panel::-webkit-scrollbar-thumb { background: #555; border-radius: 6px; }
        .right-panel::-webkit-scrollbar-thumb:hover { background: #777; }
        .status-messages {
            font-size: 0.8em; color: #aaa; margin-top: 4px;
            text-align: center; min-height: 1em; width: 100%;
        }
        #dynamicRecentEventsContainer {
            width: calc(100% - 16px); margin-top: 10px; padding: 8px;
            background-color: #272729; border-radius: 5px; box-sizing: border-box;
            overflow-y: auto; flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç */
        }
        #dynamicRecentEventsContainer .section-title { font-size: 1.1em; margin-bottom: 6px; }
        #dynamicRecentEventsList li {
            background-color: #38383a; padding: 6px 8px; font-size: 0.9em;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 3px solid #ff9800;
        }
        #dynamicRecentEventsList .event-name { font-weight: normal; }
        #dynamicRecentEventsList .event-meta { font-size: 0.85em; color: #c0c0c0; }
        #dynamicRecentEventsList .event-timeout { font-size: 0.8em; color: #999; margin-left: 8px;}

        /* --- –ê–î–ê–ü–¢–ê–¶–ò–Ø (–û–ë–´–ß–ù–´–ô –†–ï–ñ–ò–ú) --- */
        @media (max-width: 768px) and (orientation: portrait) {
            .app-wrapper { padding: 5px; }
            .main-container { flex-direction: column; gap: 10px; }
            .left-panel, .right-panel { flex-basis: auto; width: 100%; }
            .right-panel { max-height: 30vh; }
            #dynamicRecentEventsContainer { order: 3; /* –ü–æ–º–µ—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ upcoming events */}
        }
        @media (max-height: 550px) and (orientation: landscape) and (max-width: 900px) { /* –û–±—ã—á–Ω—ã–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ */
            .app-wrapper { padding: 5px; }
            body { font-size: 12.5px; }
            .main-container { gap: 8px; }
            .left-panel { flex: 3; }
            .right-panel { flex: 1.8; font-size: 0.8em; padding: 8px; }
            #timerDisplay { font-size: 2.8em; }
            .control-group button { font-size: 0.85em; padding: 5px 8px; margin: 3px; }
            .control-group input[type="number"] { width: 38px; padding: 5px; font-size: 0.85em;}
            .section-title { font-size: 1.2em; }
            #upcomingEvents li { padding: 6px 8px; font-size: 0.95em; }
            #dynamicRecentEventsContainer { display: block; order: 3; }
            .right-panel { max-height: calc(100vh - 20px); }
        }
        @media (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
            body { font-size: 13.5px; }
            .left-panel { flex: 2.2; }
            .right-panel { flex: 1.8; }
        }

        /* --- LOCKSCREEN –†–ï–ñ–ò–ú --- */
        body.horizontal-lockscreen-mode {
            font-size: 16px; /* –ë–∞–∑–æ–≤—ã–π –¥–ª—è LockScreen, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å vh/vw –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è */
        }
        body.horizontal-lockscreen-mode .app-wrapper {
            padding: 0; /* –ë–µ–∑ –æ—Ç—Å—Ç—É–ø–æ–≤ */
            overflow: hidden; /* –°—Ç—Ä–æ–≥–æ –±–µ–∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        }
        body.horizontal-lockscreen-mode .main-container {
            flex-direction: column; /* –û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            height: 100%; /* –ó–∞–Ω—è—Ç—å –≤—Å—é –≤—ã—Å–æ—Ç—É viewport */
            width: 100%;
            padding: 2vh 2vw; /* –û—Ç—Å—Ç—É–ø—ã –≤ % –æ—Ç viewport */
            gap: 1.5vh;
            justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            box-sizing: border-box;
            background-color: #000; /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –¥–ª—è LockScreen */
        }
        body.horizontal-lockscreen-mode .controls-column,
        body.horizontal-lockscreen-mode .right-panel, /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π –ª–æ–≥ */
        body.horizontal-lockscreen-mode #wakeLockStatus,
        body.horizontal-lockscreen-mode #notificationStatus,
        body.horizontal-lockscreen-mode #upcomingEvents > .section-title, /* –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ "–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è" */
        body.horizontal-lockscreen-mode #lockScreenToggle { /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–µ–∂–∏–º–∞ */
            display: none !important;
        }
        body.horizontal-lockscreen-mode .left-panel {
            flex: 1; width: 100%;
            justify-content: flex-start; /* –¢–∞–π–º–µ—Ä –≤–≤–µ—Ä—Ö—É, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –Ω–∏–∂–µ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
            overflow: hidden;
            gap: 2vh;
        }
        body.horizontal-lockscreen-mode #timerDisplay {
            font-size: min(12vh, 10vw); /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–∞–π–º–µ—Ä–∞ */
            line-height: 1;
            margin-bottom: 1vh;
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞—Ç—å */
        }
        body.horizontal-lockscreen-mode #upcomingEvents {
            width: 100%;
            max-width: none; /* –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ */
            flex-grow: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ */
            overflow-y: hidden; /* –°—Ç–∞—Ä–∞–µ–º—Å—è —É–º–µ—Å—Ç–∏—Ç—å –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞ */
             display: flex; flex-direction: column; justify-content: space-around; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å 3-5 —Å–æ–±—ã—Ç–∏–π */
        }
        body.horizontal-lockscreen-mode #upcomingEvents ul {
            display: flex; flex-direction: column;
            height: 100%;
            justify-content: space-around; /* –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã */
        }
        body.horizontal-lockscreen-mode #upcomingEvents li {
            padding: 1.5vh 2vw;
            font-size: min(3vh, 2.8vw); /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Å–æ–±—ã—Ç–∏–π */
            border-left-width: 5px; /* –ó–∞–º–µ—Ç–Ω–µ–µ */
            flex-grow: 1; margin-bottom: 1vh; /* –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ */
            display: flex; flex-direction: column; justify-content: center;
        }
        body.horizontal-lockscreen-mode #upcomingEvents li:last-child { margin-bottom: 0; }

        body.horizontal-lockscreen-mode #upcomingEvents li .event-details {
             flex-direction: column; align-items: flex-start; gap: 0.5vh;
        }
        body.horizontal-lockscreen-mode #upcomingEvents li .event-name { font-size: 1em; }
        body.horizontal-lockscreen-mode #upcomingEvents li .event-time { font-size: 0.8em; }
        body.horizontal-lockscreen-mode #upcomingEvents li .progress-bar-container {
            height: 1.8vh; /* –ë–æ–ª—å—à–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
            border-radius: 0.9vh;
            margin-top: 1vh;
        }
        body.horizontal-lockscreen-mode #dynamicRecentEventsContainer {
            display: block !important;
            width: 100%;
            padding: 1vh 1.5vw;
            font-size: min(2.2vh, 2vw);
            background-color: #111; /* –¢–µ–º–Ω–µ–µ –¥–ª—è –Ω–µ–¥–∞–≤–Ω–∏—Ö */
            border-top: 1px solid #333;
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞—Ç—å */
            max-height: 25vh; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –¥–ª—è –Ω–µ–¥–∞–≤–Ω–∏—Ö */
            overflow-y: auto;
        }
        body.horizontal-lockscreen-mode #dynamicRecentEventsContainer .section-title {
            display: block; font-size: 0.9em; margin-bottom: 0.5vh; color: #ccc;
        }
        body.horizontal-lockscreen-mode #dynamicRecentEventsList li {
            padding: 0.8vh 1vw; font-size: 1em;
        }
        body.horizontal-lockscreen-mode #dynamicRecentEventsList .event-timeout { display: inline; }
        /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, —Ö–æ—Ç—è ESC/–∂–µ—Å—Ç –Ω–∞–∑–∞–¥ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å) */
        /* #exitLockScreenButton { position: fixed; top: 10px; right: 10px; z-index: 10000; ... } */
    </style>
</head>
<body>
    <div class="app-wrapper">
        <div class="main-container">
            <div class="left-panel">
                <div id="timerDisplay">00:00</div>
                <div class="controls-column">
                    <div class="control-group time-sync-controls">
                        <input type="number" id="syncMinutes" placeholder="MM" min="0">
                        <span>:</span>
                        <input type="number" id="syncSeconds" placeholder="SS" min="0" max="59">
                        <button id="syncButton">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <div class="control-group main-controls">
                        <button id="startButton">Start Timer</button>
                        <button id="resetButton">Reset Timer</button>
                        <button id="lockScreenToggle">üì± –ì–æ—Ä–∏–∑–æ–Ω—Ç. –†–µ–∂–∏–º</button> </div>
                    <div class="control-group notification-controls">
                        <button id="toggleNotificationsButton">–í–∫–ª—é—á–∏—Ç—å –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                    </div>
                </div>
                 <div id="wakeLockStatus" class="status-messages"></div>
                 <div id="notificationStatus" class="status-messages"></div>

                <div id="upcomingEvents" style="width:100%; max-width:600px;">
                    <h2 class="section-title">–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
                    <ul id="eventsList"></ul>
                </div>
                <div id="dynamicRecentEventsContainer">
                    <h2 class="section-title">–ù–µ–¥–∞–≤–Ω–∏–µ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
                    <ul id="dynamicRecentEventsList"></ul>
                </div>
            </div>
            <div class="right-panel">
                <h2 class="section-title">–ü–æ–ª–Ω—ã–π –õ–æ–≥</h2>
                <ul id="pastEventsLogList"></ul>
            </div>
        </div>
    </div>
    <audio id="warningSoundPlayer" src="warning_alert.mp3" preload="auto"></audio>
    <audio id="eventNowSoundPlayer" src="event_now_alert.mp3" preload="auto"></audio>

    <script>
        // ... (–≤–µ—Å—å JavaScript –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ v6) ...
        // –î–û–ë–ê–í–õ–Ø–ï–ú –ù–û–í–´–ô –ö–û–î –ù–ò–ñ–ï:

        const lockScreenToggleButton = document.getElementById('lockScreenToggle');
        // const exitLockScreenButton = document.getElementById('exitLockScreenButton'); // –ï—Å–ª–∏ —Ä–µ—à–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞

        // --- LockScreen Mode Logic ---
        async function enterLockScreenMode() {
            document.body.classList.add('horizontal-lockscreen-mode');
            document.querySelector('.app-wrapper').scrollTop = 0; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –æ–±–µ—Ä—Ç–∫–∏
            lockScreenToggleButton.textContent = '–í—ã–π—Ç–∏ –∏–∑ –ì–æ—Ä–∏–∑–æ–Ω—Ç.';
            // exitLockScreenButton.style.display = 'block'; // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞

            if (document.documentElement.requestFullscreen) {
                try { await document.documentElement.requestFullscreen(); } catch (err) { console.warn("Fullscreen request failed:", err.message); }
            }
            if (screen.orientation && screen.orientation.lock) {
                try { await screen.orientation.lock('landscape'); } catch (err) { console.warn("Orientation lock failed:", err.message); }
            }
            if (isTimerRunning && !wakeLockSentinel) { // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä —É–∂–µ –∏–¥–µ—Ç, –∑–∞–ø—Ä–æ—Å–∏—Ç—å wake lock
                await requestWakeLock();
            }
            updateUpcomingEventsDisplay(true); // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—å—à–µ —Å–æ–±—ã—Ç–∏–π
            updateDynamicRecentEventsDisplay(); // –û–±–Ω–æ–≤–∏—Ç—å, —Ç.–∫. —Ä–∞–∑–º–µ—Ä—ã –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
        }

        async function exitLockScreenMode() {
            document.body.classList.remove('horizontal-lockscreen-mode');
            lockScreenToggleButton.textContent = 'üì± –ì–æ—Ä–∏–∑–æ–Ω—Ç. –†–µ–∂–∏–º';
            // exitLockScreenButton.style.display = 'none';

            if (document.fullscreenElement && document.exitFullscreen) {
                try { await document.exitFullscreen(); } catch (err) { console.warn("Exit fullscreen failed:", err.message); }
            }
            if (screen.orientation && screen.orientation.unlock) {
                try { screen.orientation.unlock(); } catch (err) { console.warn("Orientation unlock failed:", err.message); }
            }
            // Wake lock —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º Start/Pause/Reset, –∑–¥–µ—Å—å –Ω–µ —Ç—Ä–æ–≥–∞–µ–º, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–µ –±—ã–ª–æ —Å–ø–µ—Ü. –ª–æ–≥–∏–∫–∏ –¥–ª—è lockscreen
            updateUpcomingEventsDisplay(false); // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ã—á–Ω–æ–µ –∫–æ–ª-–≤–æ —Å–æ–±—ã—Ç–∏–π
        }

        lockScreenToggleButton.addEventListener('click', () => {
            if (document.body.classList.contains('horizontal-lockscreen-mode')) {
                exitLockScreenMode();
            } else {
                enterLockScreenMode();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è ESC –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ fullscreen (–±—Ä–∞—É–∑–µ—Ä —Å–∞–º –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ fullscreen, –º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ UI)
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && document.body.classList.contains('horizontal-lockscreen-mode')) {
                // –ï—Å–ª–∏ –≤—ã—à–ª–∏ –∏–∑ fullscreen (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ ESC), –∞ —Ä–µ–∂–∏–º LockScreen –µ—â–µ –∞–∫—Ç–∏–≤–µ–Ω –≤ UI
                exitLockScreenMode(); // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º UI
            }
        });
        
        // --- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è updateUpcomingEventsDisplay ---
        // –ó–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é updateUpcomingEventsDisplay –Ω–∞ —ç—Ç—É:
        function updateUpcomingEventsDisplay(isLockScreen = false) { // –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä
            const upcoming = [];
            const displayLimitFutureSeconds = gameTimeInSeconds + 15 * 60;
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const maxEventsToShow = isLockScreen ? 4 : 7; // 4 –¥–ª—è LockScreen, 7 –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ

            eventStates.forEach(event => {
                // ... (–ª–æ–≥–∏–∫–∞ —Å–±–æ—Ä–∞ upcoming —Å–æ–±—ã—Ç–∏–π –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–æ–π –∂–µ, –∫–∞–∫ –≤ v6) ...
                 if (event.isOneTime && !event.alertedEvent) {
                    if (event.spawnTime <= displayLimitFutureSeconds && event.spawnTime > gameTimeInSeconds) {
                        upcoming.push({ name: event.name, time: event.spawnTime, eventObj: event });
                    }
                } else if (event.spawnTimes) {
                     event.spawnTimes.forEach((spawnTime, index) => {
                        if (!event.alertedEvent[index] && spawnTime <= displayLimitFutureSeconds && spawnTime > gameTimeInSeconds) {
                             upcoming.push({ name: `${event.name}`, time: spawnTime, eventObj: event, spawnIndex: index });
                        }
                    });
                } else if (!event.isOneTime && !event.spawnTimes) { 
                    if (event.nextSpawnTime <= displayLimitFutureSeconds && gameTimeInSeconds < event.nextSpawnTime) {
                        upcoming.push({ name: event.name, time: event.nextSpawnTime, eventObj: event });
                    }
                }
            });

            upcoming.sort((a, b) => a.time - b.time);
            eventsList.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Å–ø–∏—Å–æ–∫
            
            upcoming.slice(0, maxEventsToShow).forEach(e => { // –ò—Å–ø–æ–ª—å–∑—É–µ–º maxEventsToShow
                const listItem = document.createElement('li');
                const timeToSpawn = e.time - gameTimeInSeconds;
                let progressBarHtml = '';
                if (timeToSpawn <= PROGRESS_WINDOW_SECONDS && timeToSpawn > 0) {
                    const elapsedInWindow = PROGRESS_WINDOW_SECONDS - timeToSpawn;
                    const progressPercent = Math.min(100, Math.max(0, (elapsedInWindow / PROGRESS_WINDOW_SECONDS) * 100));
                    progressBarHtml = `<div class="progress-bar-container"><div class="progress-bar" style="width: ${progressPercent}%;"></div></div>`;
                }
                listItem.innerHTML = `<div class="event-details"><span class="event-name">${e.name}</span><span class="event-time">—á–µ—Ä–µ–∑ ${formatTime(timeToSpawn)} (–≤ ${formatTime(e.time)})</span></div>${progressBarHtml}`;
                let isWarningActive = false;
                if (e.eventObj.isOneTime) isWarningActive = e.eventObj.alertedWarning;
                else if (e.eventObj.spawnTimes) isWarningActive = e.eventObj.alertedWarning[e.spawnIndex];
                else isWarningActive = e.eventObj.alertedWarning;
                if (timeToSpawn <= 0 && timeToSpawn > -ALERT_OFFSET_SECONDS) listItem.classList.add('alert-event-now');
                else if (isWarningActive && timeToSpawn > 0 && timeToSpawn <= ALERT_OFFSET_SECONDS) listItem.classList.add('alert-warning');
                eventsList.appendChild(listItem);
            });
            // ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è '–Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π' –æ—Å—Ç–∞–µ—Ç—Å—è) ...
            if (upcoming.length === 0 && isTimerRunning) eventsList.innerHTML = '<li>–ù–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã—Ö —Å–æ–±—ã—Ç–∏–π.</li>';
            else if (!isTimerRunning && upcoming.length === 0) eventsList.innerHTML = '<li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ —Ç–∞–π–º–µ—Ä.</li>';
            else if (!isTimerRunning && gameTimeInSeconds === 0) eventsList.innerHTML = '<li>–¢–∞–π–º–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω.</li>';
        }


        // --- JavaScript –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (v6) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ —Ç–µ—Ö, —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã –≤—ã—à–µ ---
        // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –í–ï–°–¨ JavaScript –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ (v6), 
        // –ó–ê –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï–ú —Ñ—É–Ω–∫—Ü–∏–∏ updateUpcomingEventsDisplay, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–º–µ–Ω–∏–ª–∏ –≤—ã—à–µ.
        // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ lockScreenToggleButton –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ const –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞.
        // const timerDisplay = document.getElementById('timerDisplay');
        // const startButton = document.getElementById('startButton');
        // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
        // –í–∫–ª—é—á–∞—è –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏: getBaseEventDefinitions, initializeEventStates, rebuildPastEventsLog, formatTime,
        // updateTimerDisplay, playSound, updatePastEventsLogDisplay, checkAndTriggerAlerts,
        // mainLoop, attemptInitialSoundUnlock, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è startButton, resetButton, syncButton,
        // updateNotificationButtonText, toggleNotificationsButton listener, showBrowserNotification,
        // requestWakeLock, releaseWakeLock, visibilitychange listener.

        // –ò –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ, –ø–µ—Ä–µ–¥ </script>:
        // updateAllDisplays(); // –í—ã–∑—ã–≤–∞–µ–º –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
        // updateNotificationButtonText(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        // (–≠—Ç–æ —É–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –∫–æ–¥–µ v6)
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—ç—Ç–æ—Ç –±–ª–æ–∫ —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞ v6)
        // initializeEventStates(0);
        // updateAllDisplays(); // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç—å updateDynamicRecentEventsDisplay()
        // updateNotificationButtonText(); // –≠—Ç–æ —Ç–æ–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
        
        // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `updateAllDisplays` –≤–∫–ª—é—á–∞–µ—Ç `updateDynamicRecentEventsDisplay`
        // function updateAllDisplays() {
        //     updateTimerDisplay();
        //     updateUpcomingEventsDisplay(document.body.classList.contains('horizontal-lockscreen-mode')); // –ü–µ—Ä–µ–¥–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ LockScreen
        //     updatePastEventsLogDisplay();
        //     updateDynamicRecentEventsDisplay();
        // }
        // (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ updateAllDisplays –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∞ –∑–Ω–∞–ª–∞ –æ lockscreen mode –¥–ª—è upcoming events)
        // –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ –±—É–¥–µ—Ç –≤ `enterLockScreenMode` –∏ `exitLockScreenMode` –≤—ã–∑—ã–≤–∞—Ç—å `updateUpcomingEventsDisplay` —Å –Ω—É–∂–Ω—ã–º —Ñ–ª–∞–≥–æ–º.

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º updateAllDisplays, —á—Ç–æ–±—ã –æ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–∑—ã–≤–∞–ª–∞ updateUpcomingEventsDisplay
        function updateAllDisplays() {
            updateTimerDisplay();
            updateUpcomingEventsDisplay(document.body.classList.contains('horizontal-lockscreen-mode'));
            updatePastEventsLogDisplay();
            updateDynamicRecentEventsDisplay();
        }
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        initializeEventStates(0);
        updateAllDisplays();
        updateNotificationButtonText();


    </script>
</body>
</html>
